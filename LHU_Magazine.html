<!DOCTYPE html>
<html lang="vi">

<head>
    <script>
        if (localStorage.getItem("lh_access_granted") !== "true") {
            alert("Bạn cần đăng nhập trước!");
            window.location.href = "index.html";
        }
    </script>
<!-- Flatpickr CSS + Theme đẹp (material_blue rất hợp với accent xanh #2563eb) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Kiểm Tra & Xuất Bản Thảo Bài Báo - JSLHU</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
        :root {
            --bg: #ffffff;
            /* Trắng sáng hẳn */
            --text: #111827;
            /* Đen đậm, dễ đọc */
            --text-muted: #4b5563;
            /* Xám phụ */
            --card-bg: #ffffff;
            /* Panel trắng sạch */
            --blur: blur(0px);
            /* Không blur nặng, giữ rõ nét */
            --accent: #2563eb;
            /* Xanh dương LHU chuẩn, tươi sáng */
            --accent-dark: #1d4ed8;
            --accent-glow: rgba(37, 99, 235, 0.15);
            --border: #d1d5db;
            /* Border xám nhạt */
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            /* Shadow nhẹ, tinh tế */
            --input-bg: #f9fafb;
            /* Input nền trắng xám nhẹ */
            --preview-bg: #ffffff;
            /* Preview trắng giấy */
            --preview-text: #000000;
        }

        /* Thêm vào cuối phần :root hoặc CSS */
        #logoutBtn {
            padding: 0.6rem 1.2rem;
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        #logoutBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
            background: linear-gradient(90deg, #dc2626, #ef4444);
        }

        /* Dark mode: giữ màu đỏ nổi bật */
        [data-theme="dark"] #logoutBtn {
            background: linear-gradient(90deg, #f87171, #ef4444);
            box-shadow: 0 4px 12px rgba(248, 113, 113, 0.4);
        }

        [data-theme="dark"] #logoutBtn:hover {
            box-shadow: 0 8px 25px rgba(248, 113, 113, 0.6);
        }

        [data-theme="dark"] {
            --bg: #0a0e17;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --card-bg: rgba(15, 23, 42, 0.92);
            --blur: blur(16px);
            --accent: #60a5fa;
            --accent-dark: #3b82f6;
            --accent-glow: rgba(96, 165, 250, 0.25);
            --border: rgba(96, 165, 250, 0.18);
            --shadow: 0 10px 35px rgba(0, 0, 0, 0.6);
            --input-bg: rgba(30, 41, 59, 0.8);
            --preview-bg: #f8fafc;
            --preview-text: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: all 0.4s ease;
        }

        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--accent);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            color: var(--accent);
            transform: scale(1.15);
        }

        .main-content {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .container-top {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .container-top {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.8rem;
            box-shadow: var(--shadow);
        }

        .left,
        .middle {
            background: #f9fafb;
            /* Nền trắng xám rất nhẹ cho phân biệt */
        }

        [data-theme="dark"] .left,
        [data-theme="dark"] .middle {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.7), rgba(30, 41, 59, 0.5));
        }

        h2 {
            color: var(--accent);
            margin-bottom: 1.2rem;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 1.4rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-muted);
        }

        input,
        textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text);
            transition: all 0.3s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        .ql-container {
            background: white !important;
            color: #111827 !important;
            border-radius: 8px;
            min-height: 340px;
            border: 1px solid #d1d5db !important;
        }

        [data-theme="dark"] .ql-container {
            background: #1e293b !important;
            color: #e2e8f0 !important;
        }

        button {
            padding: 0.9rem 1.6rem;
            background: linear-gradient(90deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px var(--accent-glow);
            margin: 0.5rem 0.8rem 0.5rem 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--accent-glow);
        }

        #aiFeedback {
            background: #f9fafb;
            border-radius: 10px;
            padding: 1.2rem;
            min-height: 320px;
            line-height: 1.6;
            border: 1px solid var(--border);
            color: var(--text);
        }

        [data-theme="dark"] #aiFeedback {
            background: rgba(30, 41, 59, 0.6);
        }

        .preview-wrapper {
            margin-top: 2rem;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .preview {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 20mm 18mm 20mm 22mm;
            background: var(--preview-bg);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08);
            font-family: "Times New Roman", Times, serif;
            font-size: 12pt;
            line-height: 1.6;
            color: var(--preview-text);
        }

        /* Định dạng heading trong preview giống Word / hình của bạn */
        #preview-content {
            margin-top: 40px;
            column-count: 2;
            column-gap: 40px;
            line-height: 1.7;
            font-size: 10pt;
            text-align: justify;
            hyphens: auto;
        }

        #preview-content h1,
        #preview-content h2,
        #preview-content h3 {
            font-weight: bold;
            margin: 20px 0 10px;
            break-after: avoid-column;
            /* Tránh heading bị cắt giữa 2 cột */
        }

        #preview-content h1 {
            font-size: 10pt;
            text-transform: uppercase;
            color: #2a4e8a;
            text-align: left;
            /* Hoặc left nếu muốn giống một số mẫu */
            margin: 0px 0 5px;
        }

        #preview-content h2 {
            font-size: 10pt;
            margin-left: 0;
        }

        #preview-content h3 {
            font-size: 10pt;
            margin-left: 20px;
            /* Indent nhẹ cho cấp 2.1, 3.1... */
        }

        #preview-content p {
            margin: 0 0 12px 0;
        }

        #preview-content strong {
            font-weight: bold;
        }

        /* Nếu dùng list ordered trong Quill, style đẹp hơn */
        #preview-content ol {
            margin: 10px 0 10px 30px;
            padding-left: 20px;
        }

        #preview-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        #preview-content {
            column-count: 2;
            column-gap: 40px;
            margin-top: 1.5rem;
            text-align: justify;
            /* Mặc định justify cho văn bản */
        }

        /* Hỗ trợ căn giữa từ Quill */
        #preview-content .ql-align-center {
            text-align: center !important;
        }

        /* Ảnh căn giữa tự động nếu được đặt center trong Quill */
        #preview-content img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1em auto;
            /* Tự động căn giữa ảnh */
        }

        /* Bảng căn giữa nếu cần */
        #preview-content table {
            margin: 1em auto;
            width: auto;
            /* Hoặc 100% tùy ý */
        }

        #preview-content table th,
        #preview-content table td {
            border: 1px solid #aaa;
            padding: 8px;
            text-align: left;
        }

        #preview-content table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-muted);
            font-size: 10px;
            margin-top: 2rem;
            border-top: 1px solid var(--border);
        }
        /* Flatpickr override để đẹp, khớp theme LHU */
.flatpickr-calendar {
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    border-radius: 12px;
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: var(--card-bg);
    color: var(--text);
}

.flatpickr-day.selected,
.flatpickr-day.startRange,
.flatpickr-day.endRange,
.flatpickr-day.today.selected {
    background: var(--accent) !important;
    border-color: var(--accent) !important;
    color: white !important;
}

.flatpickr-day:hover,
.flatpickr-day:focus {
    background: var(--accent-glow) !important;
    border-color: var(--accent) !important;
}

.flatpickr-current-month .cur-month,
.flatpickr-current-month input.cur-year {
    color: var(--accent) !important;
}

.flatpickr-weekdays {
    background: var(--input-bg);
}

.flatpickr-day.today {
    border-color: var(--accent);
}

/* Dark mode */
[data-theme="dark"] .flatpickr-calendar {
    background: #1e293b;
    color: #e2e8f0;
}

[data-theme="dark"] .flatpickr-day.inRange,
[data-theme="dark"] .flatpickr-day.prevMonthDay.inRange,
[data-theme="dark"] .flatpickr-day.nextMonthDay.inRange,
[data-theme="dark"] .flatpickr-day.today.inRange {
    background: rgba(37, 99, 235, 0.2) !important;
}
    </style>
    <!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- Plugin cho month/year only (rất quan trọng nếu chỉ muốn chọn tháng/năm) -->
<script src="https://npmcdn.com/flatpickr@4.6.13/dist/plugins/monthSelect/index.js"></script>
<!-- Hoặc dùng phiên bản mới nhất từ unpkg nếu cần: https://unpkg.com/flatpickr/dist/plugins/monthSelect/index.js -->
</head>

<body data-theme="light">

    <header>
        <h1>Journal of Science LHU - Soạn thảo & AI Review</h1>
        <div style="display: flex; align-items: center; gap: 1.2rem;">
            <button class="theme-toggle" id="themeBtn" aria-label="Chuyển chế độ">
                <i class="fas fa-moon"></i>
            </button>
            <button id="logoutBtn" style="
            padding: 0.6rem 1.2rem;
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(239,68,68,0.3);
        ">
                <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem;"></i>
                Đăng xuất
            </button>
        </div>
    </header>

    <div class="main-content">

        <!-- Phần trên: Nhập liệu + AI (2 cột) - giữ nguyên -->
        <div class="container-top">
            <!-- LEFT: Form nhập liệu -->
            <div class="panel left">
                <h2>Nhập nội dung</h2>
                <div class="form-group">
                    <label>Tiêu đề (Tiếng Việt):</label>
                    <input type="text" id="title_vi" placeholder="Ví dụ: ỨNG DỤNG SPSS VÀ AI TRONG GIÁM SÁT...">
                </div>
                <div class="form-group">
                    <label>Tiêu đề (English):</label>
                    <input type="text" id="title_en"
                        placeholder="Ví dụ: Applying SPSS and AI to Monitor School Railing Safety...">
                </div>
                <div class="form-group">
                    <label>Tác giả:</label>
                    <input type="text" id="authors" value="Lê Phương Long, Võ Nhạc Phước, Nguyễn Kim Ngọc Bích">
                </div>
                <div class="form-group">
                    <label>Tác giả liên hệ (email):</label>
                    <input type="email" id="contact" value="phuonglong@lhu.edu.vn">
                </div>
                <div class="form-group">
                    <label>Tóm tắt (Tiếng Việt):</label>
                    <textarea id="abstract_vi"
                        rows="5">An toàn lan can học đường là vấn đề cấp thiết toàn cầu...</textarea>
                </div>
                <div class="form-group">
                    <label>Abstract (English):</label>
                    <textarea id="abstract_en" rows="5">School railing safety is a pressing global issue...</textarea>
                </div>
                <div class="form-group">
                    <label>Từ khóa (Tiếng Việt):</label>
                    <input type="text" id="keywords_vi"
                        value="SPSS; Trí tuệ nhân tạo (AI); Giám sát hành vi; An toàn lan can; Học sinh vị thành niên">
                </div>
                <div class="form-group">
                    <label>Keywords (English):</label>
                    <input type="text" id="keywords_en"
                        value="SPSS; Artificial Intelligence (AI); Behavior monitoring; Railing safety; Adolescent students">
                </div>
                <div class="form-group">
                    <label>Nội dung chính:</label>
                    <div id="editor" class="quill-editor" style="height: 340px;"></div>
                </div>
<div class="form-group">
    <label>Ngày xuất bản (Issue & Ngày/Tháng/Năm):</label>
    <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
        
        <input type="text" id="publishDate" placeholder="Chọn ngày/tháng/năm (ví dụ: 15 March 2025)" style="flex: 1; min-width: 220px; padding: 0.8rem 1rem; border: 1px solid var(--border); border-radius: 8px; background: var(--input-bg); color: var(--text);">
    </div>
    <small style="color: var(--text-muted); display: block; margin-top: 4px;">
    </small>
</div>
                <div class="form-group">
                    <label>Template Word (.docx):</label>
                    <input type="file" id="templateFile" accept=".docx">
                </div>
                <button id="analyzeBtn">AI Kiểm tra & Gợi ý</button>
                <button id="exportBtn">Xuất ra Word (.docx)</button>
            </div>
            <!-- MIDDLE: AI gợi ý -->
            <div class="panel middle">
                <h2>AI Kiểm Tra Chất Lượng</h2>
                <div id="aiFeedback">
                    <p>Nhấn nút "AI Kiểm tra & Gợi ý" để nhận phân tích...</p>
                </div>
            </div>
        </div>

        <!-- Phần dưới: Preview full width - giữ nguyên -->
        <div class="container-bottom">
            <div class="preview-wrapper">
                <div style="text-align: right; margin: 15px 0;">
                    <button id="copyPreviewBtn" style="
        padding: 10px 20px;
        background: linear-gradient(90deg, #10b981, #059669);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(16,185,129,0.3);
        transition: all 0.3s;
    ">
                        <i class="fas fa-copy" style="margin-right: 8px;"></i>
                        Tô nhanh nội dung chính
                    </button>
                </div>
                <div class="preview">
                    <!-- Header -->
                    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                        <img src="image.png" alt="JSLHU Logo" style="height:60px;">
                        <div>
                            <span
                                style="font-size:21px; font-family:Cambria; color:#9bb0c9; letter-spacing:1px;">JOURNAL
                                OF
                                SCIENCE</span><br>
                            <span
                                style="font-size:15px; font-family:'Times New Roman', Times, serif; color:#9bb0c9; font-weight:bold;">OF
                                LAC HONG UNIVERSITY</span>
                        </div>
                        <div style="flex:1"></div>
                        <div style="text-align:right;">
                            <span style="font-size:15px; color:#9bb0c9; font-weight:bold;">ISSN: 2525 - 2186</span><br>
                            <span style="font-size:15px; color:#9bb0c9;">Tạp chí Khoa học Lạc Hồng, 2025, 20,
                                001-005</span>
                        </div>
                    </div>
                    <hr style="margin:0 0 16px 0;">
                    <!-- Tiêu đề tiếng Việt -->
                    <div style="text-align:center;">
                        <div style="font-size:20px; color:#2a4e8a; font-weight:bold; text-transform:uppercase; line-height:1.2;"
                            id="preview-title-vi"></div>
                    </div>
                    <!-- Tác giả & địa chỉ -->
                    <div style="text-align:right; font-size:17px; margin-top:8px; font-weight:200;"
                        id="preview-authors">
                    </div>
                    <div style="text-align:right; font-size:15px; font-style:italic; margin-bottom:4px;">
                        Trường Đại học Lạc Hồng, Số 10 Huỳnh Văn Nghệ, phường Bửu Long, Biên Hòa, Đồng Nai, Vietnam
                    </div>
                    <div style="text-align:right; font-size:15px; margin-bottom:16px;">
                        *Tác giả liên hệ: <span id="preview-contact" style="font-style:italic;"></span>
                    </div>
                    <!-- Bảng thông tin + Tóm tắt tiếng Việt -->
                    <table style="margin-top:16px; border-collapse:collapse; width:100%; font-size:14px;">
                        <tr>
                            <th
                                style="width:32%; font-size:15px; background:#ffffff; border:1px solid #aaa; padding:8px;">
                                THÔNG TIN BÀI BÁO</th>
                            <th style="font-size:15px; background:#ffffff; border:1px solid #aaa; padding:8px;">TÓM TẮT
                            </th>
                        </tr>
                        <tr>
                            <td style="font-size:15px; vertical-align:top; border:1px solid #aaa; padding:8px;">
                                Ngày nhận: <br>
                                Ngày hoàn thiện: <br>
                                Ngày chấp nhận: <br>
                                Ngày đăng: <br><br>
                                <b>TỪ KHÓA</b><br>
                                <span id="preview-keywords-vi" style="line-height:1.4;"></span>
                            </td>
                            <td style="vertical-align:top; border:1px solid #aaa; padding:8px;"
                                id="preview-abstract-vi">
                            </td>
                        </tr>
                    </table>
                    <!-- Phần tiếng Anh – trang mới, bố cục giống tiếng Việt hơn (căn phải cho authors & contact) -->
                    <div style="margin-top:60px; page-break-before: always; break-before: page;">
                        <div style="text-align:center;">
                            <div style="font-size:20px; color:#2a4e8a; font-weight:bold; text-transform:uppercase; line-height:1.2;"
                                id="preview-title-en"></div>
                        </div>
                        <!-- Tác giả & địa chỉ - căn phải giống phần VI -->
                        <div style="text-align:right; font-size:17px; margin-top:12px; font-weight:500;"
                            id="preview-authors-en"></div>
                        <div style="text-align:right; font-style:italic; font-size:15px; margin-bottom:4px;">
                            Lac Hong University, No. 10 Huynh Van Nghe Street, Buu Long Ward, Bien Hoa, Dong Nai
                            Province,
                            Vietnam
                        </div>
                        <div style="text-align:right; font-size:15px; margin-bottom:24px;">
                            *Corresponding Author: <span id="preview-contact-en" style="font-style:italic;"></span>
                        </div>
                        <!-- Bảng thông tin song song, full-width giống phần VI (không auto margin) -->
                        <table style="margin-top:16px; border-collapse:collapse; width:100%; font-size:14px;">
                            <tr>
                                <th
                                    style="width:35%; font-size:15px; background:#ffffff; border:1px solid #aaa; padding:10px;">
                                    ARTICLE INFORMATION</th>
                                <th style="font-size:15px; background:#ffffff; border:1px solid #aaa; padding:10px;">
                                    ABSTRACT</th>
                            </tr>
                            <tr>
                                <td style="font-size:15px; vertical-align:top; border:1px solid #aaa; padding:10px;">
                                    Received: <br>
                                    Revised: <br>
                                    Accepted: <br>
                                    Published: <br><br>
                                    <b>KEYWORDS</b><br>
                                    <span id="preview-keywords-en" style="line-height:1.5;"></span>
                                </td>
                                <td style="vertical-align:top; border:1px solid #aaa; padding:10px;"
                                    id="preview-abstract-en"></td>
                            </tr>
                        </table>
                    </div>
                    <!-- Nội dung chính (body của bài báo) -->
                    <div id="preview-content">
                        <div class="form-group">
                            <label>Nội dung chính:</label>
                            <small style="color:#555; display:block; margin-bottom:8px;">
                                • Sử dụng Heading 1 cho mục lớn (ví dụ: 2. MÔ HÌNH NGHIÊN CỨU – gõ số tay rồi apply
                                Heading
                                1).<br>
                                • Heading 2 cho mục con (2.1 ...).<br>
                                • Dùng numbered list nếu cần danh sách tự động 1. 2. 3.
                            </small>
                            <div id="editor" style="height: 400px; background:white;"></div>
                            <!-- tăng height cho thoải mái -->
                        </div>
                    </div>
                </div> <!-- kết thúc .preview -->
            </div>
        </div>

    </div>

    <footer>
        © 2026 Journal of Science - Lac Hong University | Powered by AI & Local Tools
    </footer>

    <!-- Scripts giữ nguyên -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.8/dist/pizzip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.48.0/build/docxtemplater.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pizzip-utils@3.1.8/dist/pizzip-utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Quill Image Resize Module -->
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>
    
    <script>
        // Month/Year Picker đẹp (sử dụng plugin monthSelect)
flatpickr("#publishDate", {
    plugins: [
        new monthSelectPlugin({
            shorthand: true,          // Tháng ngắn: Jan, Feb,...
            dateFormat: "F Y",        // Output: "March 2025"
            altFormat: "F Y",         // Hiển thị trong input: March 2025
            theme: "material_blue"    // Hoặc "light", "dark", "airbnb" – khớp accent xanh
        })
    ],
    altInput: true,               // Input ẩn, hiển thị đẹp altInput
    altFormat: "F Y",
    dateFormat: "F Y",
    defaultDate: "March 2025",    // Mặc định (hoặc new Date() cho tháng hiện tại)
    static: true,                 // Optional: picker luôn hiển thị nếu muốn inline
    onChange: function(selectedDates, dateStr, instance) {
        // Optional: cập nhật preview hoặc log
        console.log("Đã chọn:", dateStr);
        updatePreview(); // Nếu bạn muốn preview thay đổi theo
    }
});
        // Theme toggle
        const themeBtn = document.getElementById('themeBtn');
        const body = document.body;
        const savedTheme = localStorage.getItem('theme') || 'light';
        body.setAttribute('data-theme', savedTheme);
        themeBtn.innerHTML = savedTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

        themeBtn.addEventListener('click', () => {
            const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeBtn.innerHTML = newTheme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        });

        // Khởi tạo Quill
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],  // Heading
                    ['bold', 'italic', 'underline', 'strike'],  // Basic format
                    [{ 'align': [] }],  // Thêm nút căn chỉnh (left, center, right, justify)
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
                    ['link', 'image'],
                    ['clean']
                ],
                imageResize: {
                    displaySize: true
                }
            }
        });
        // Xử lý paste hình ảnh từ clipboard
        quill.root.addEventListener('paste', function (e) {
            const clipboardData = e.clipboardData || window.clipboardData;
            const items = clipboardData.items;

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                if (item.type.indexOf('image') !== -1) {
                    e.preventDefault(); // Ngăn paste mặc định

                    const file = item.getAsFile();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (event) {
                            const range = quill.getSelection(true);
                            quill.insertEmbed(range.index, 'image', event.target.result); // Chèn base64
                            quill.setSelection(range.index + 1);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            }
        }, false);

        // Để resize ảnh: thêm module imageResize (dùng CDN)

        function updatePreview() {
            const title_vi = document.getElementById('title_vi').value.trim();
            const title_en = document.getElementById('title_en').value.trim();
            const authors = document.getElementById('authors').value.trim();
            const contact = document.getElementById('contact').value.trim();
            const abstract_vi = document.getElementById('abstract_vi').value.trim();
            const abstract_en = document.getElementById('abstract_en').value.trim();
            const keywords_vi = document.getElementById('keywords_vi').value.trim();
            const keywords_en = document.getElementById('keywords_en').value.trim();
            const content = quill.root.innerHTML;

            // Tiếng Việt
            document.getElementById('preview-title-vi').textContent = title_vi || "TIÊU ĐỀ BÀI BÁO";
            document.getElementById('preview-abstract-vi').innerHTML = abstract_vi.replace(/\n/g, '<br>') || "Nhập tóm tắt tiếng Việt...";
            document.getElementById('preview-keywords-vi').innerHTML = keywords_vi.replace(/;/g, ';<br>') || "Nhập từ khóa...";

            // Tiếng Anh
            document.getElementById('preview-title-en').textContent = title_en || "ARTICLE TITLE";
            document.getElementById('preview-abstract-en').innerHTML = abstract_en.replace(/\n/g, '<br>') || "Enter English abstract...";
            document.getElementById('preview-keywords-en').innerHTML = keywords_en.replace(/;/g, '; ') || "Enter keywords...";

            // Chung
            document.getElementById('preview-authors').textContent = authors || "Tác giả";
            document.getElementById('preview-contact').textContent = contact || "email@domain.com";
            document.getElementById('preview-authors-en').textContent = authors || "Authors";
            document.getElementById('preview-contact-en').textContent = contact || "email@domain.com";

            // Nội dung chính
            document.getElementById('preview-content').innerHTML = content || "<p style='text-align:center; color:#999;'>Nội dung bài báo sẽ hiển thị ở đây (sử dụng heading trong editor để định dạng mục 2., 2.1...)</p>";
        }

        // Real-time update
        ['title_vi', 'title_en', 'authors', 'contact', 'abstract_vi', 'abstract_en', 'keywords_vi', 'keywords_en'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });
        quill.on('text-change', updatePreview);

        // AI gợi ý
        document.getElementById("analyzeBtn").onclick = async () => {
            const title_vi = document.getElementById("title_vi").value;
            const title_en = document.getElementById("title_en").value;
            const abstract_vi = document.getElementById("abstract_vi").value;
            const abstract_en = document.getElementById("abstract_en").value;
            const keywords_vi = document.getElementById("keywords_vi").value;
            const keywords_en = document.getElementById("keywords_en").value;
            const content = quill.getText();

            const prompt = `
Bạn là chuyên gia biên tập tạp chí khoa học.

Hãy kiểm tra bài báo theo tiêu chuẩn:
1. Tiêu đề: Viết hoa chữ cái đầu, không trùng từ khóa.
2. Tóm tắt: khoảng 150 đến 250 từ, có vấn đề, mục tiêu, phương pháp, kết quả, ý nghĩa.
3. Abstract EN: Dịch sát nghĩa, thì hiện tại đơn cho kết quả.
4. Từ khóa: từ 4 đến 6 cụm, không trùng tiêu đề.
5. Nội dung: Kiểm tra cấu trúc IMRAD, trích dẫn chuẩn.

Dữ liệu bài báo:

Tiêu đề VI: ${title_vi}
Tiêu đề EN: ${title_en}
Tóm tắt VI: ${abstract_vi}
Abstract EN: ${abstract_en}
Từ khóa VI: ${keywords_vi}
Từ khóa EN: ${keywords_en}
Nội dung: ${content}

Hãy phân tích chi tiết và đưa ra gợi ý cải thiện.
  `;

            document.getElementById("aiFeedback").innerHTML = "Đang phân tích...";

            try {
                const response = await fetch("https://ai-review-paper.vonhacphuoc.workers.dev", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ text: prompt })
                });

                const data = await response.json();

                if (data.result) {
                    document.getElementById("aiFeedback").innerHTML =
                        data.result.replace(/\n/g, "<br>");
                } else {
                    document.getElementById("aiFeedback").innerHTML =
                        "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
                }
            } catch (error) {
                console.error(error);
                document.getElementById("aiFeedback").innerHTML =
                    "Lỗi gọi AI. Kiểm tra Worker URL hoặc cấu hình API key!";
            }
        };

        // Xuất Word
        document.getElementById('exportBtn').onclick = async () => {
            const fileInput = document.getElementById('templateFile');
            if (!fileInput.files?.[0]) {
                alert("Vui lòng chọn file template.docx!");
                return;
            }
            if (typeof PizZip === 'undefined') {
                alert("Lỗi load thư viện PizZip. Kiểm tra kết nối mạng hoặc thử refresh trang.");
                return;
            }

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const zip = new PizZip(e.target.result);
                    const doc = new docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });

// Lấy giá trị từ Flatpickr (định dạng "d F Y" → "15 March 2025")
let publishStr = document.getElementById('publishDate').value.trim();

// Nếu không có giá trị → dùng ngày hiện tại
if (!publishStr) {
    const today = new Date();
    publishStr = today.toLocaleDateString('en-US', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    }); // → "15 March 2025"
}

// Chuyển thành "15, March, 2025" bằng cách tách và nối lại
const parts = publishStr.split(' '); // ["15", "March", "2025"]
const formattedDate = `${parts[0]} ${parts[1]}, ${parts[2]}`; // "15, March, 2025"

doc.render({
    title: document.getElementById('title_vi').value,
    title_en: document.getElementById('title_en').value,
    authors: document.getElementById('authors').value,
    contact: document.getElementById('contact').value,
    abstract: document.getElementById('abstract_vi').value,
    abstract_en: document.getElementById('abstract_en').value,
    keywords: document.getElementById('keywords_vi').value,
    keywords_en: document.getElementById('keywords_en').value,
    date: `JSLHU, Issue ${formattedDate}`,
});

                    const blob = doc.getZip().generate({ type: "blob" });
                    saveAs(blob, "Ban_thao_bai_bao.docx");
                } catch (err) {
                    console.error(err);
                    alert("Lỗi xuất file: " + (err.message || "Không xác định. Kiểm tra template.docx có placeholder đúng không."));
                }
            };
            reader.readAsArrayBuffer(fileInput.files[0]);
        };
// Date Picker đẹp: chọn ngày/tháng/năm (không cần plugin riêng)
flatpickr("#publishDate", {
    dateFormat: "d F Y",              // Output: "15 March 2025" (dễ đọc, hợp tạp chí)
    altInput: true,                   // Tạo input ẩn + hiển thị đẹp
    altFormat: "d F Y",               // Hiển thị trong ô input: 15 March 2025
    defaultDate: new Date(),          // Mặc định hôm nay (có thể đổi thành "2025-03-15")
    weekNumbers: true,                // Optional: hiển thị số tuần
    allowInput: true,                 // Cho phép gõ tay nếu cần
    onChange: function(selectedDates, dateStr, instance) {
        // Optional: cập nhật preview ngay khi chọn
        updatePreview();
    }
});
        updatePreview(); // Khởi chạy lần đầu
        // Thêm hiển thị ngày vào preview nếu cần (tuỳ chọn)
        const publishDateInput = document.getElementById('publishDate')?.value || document.getElementById('publishMonth')?.value;
        if (publishDateInput) {
            const dateObj = new Date(publishDateInput);
            const monthName = dateObj.toLocaleString('en-US', { month: 'long' });
            const year = dateObj.getFullYear();
            const displayDate = `JSLHU, Issue 20, ${monthName} ${year}`;

            // Bạn có thể chèn vào một phần tử trong preview, ví dụ footer preview
            // Hiện tại preview chưa có chỗ dành sẵn → có thể thêm tạm vào dưới ISSN
            // Hoặc chỉ dùng cho export Word
        }
        // Copy nội dung chính từ preview sang clipboard (dạng HTML)
        // Nút Tô lẹ: highlight phần preview-content để dễ chọn + copy
        document.getElementById("copyPreviewBtn").addEventListener("click", () => {
            const preview = document.getElementById("preview-content");

            if (!preview) {
                alert("Không tìm thấy phần preview!");
                return;
            }

            // Tô màu nền xanh nhạt (có thể thay màu khác)

            // Tự động chọn toàn bộ nội dung để copy nhanh
            const range = document.createRange();
            range.selectNodeContents(preview);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            // Hiển thị hướng dẫn ngắn
            alert("Đã tô màu phần nội dung chính!\nNhấn Ctrl+C để copy.\nVào Word chọn 'Keep Source Formatting'.");

            // Optional: sau 5 giây tự tắt highlight để không làm rối mắt
            setTimeout(() => {
                preview.style.backgroundColor = "";
            }, 8000); // 8 giây
        });
        // Xử lý nút Logout
        document.getElementById("logoutBtn").addEventListener("click", () => {
            if (confirm("Bạn có chắc chắn muốn đăng xuất?")) {
                localStorage.removeItem("lh_access_granted");
                localStorage.removeItem("theme"); // Optional: xóa theme nếu muốn reset
                alert("Đã đăng xuất thành công!");
                window.location.href = "index.html"; // Chuyển về trang đăng nhập
            }
        });
    </script>
</body>

</html>